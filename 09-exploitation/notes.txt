Introduction To Exploitation

- Introduction To Exploitation
    - Exploitation consists of techiniques and tools used to gain initial foothold on a target system
    - Successful exploitation depends on the nature and quality of information gathering and service enumeration
    - Phases
        - Identify vulnerable services
        - Identify and prepare exploit code
        - Gain access (msf, manual)
        - Obtain remote access on target system
        - Bypass AV detection
        - Pivot on to other systems

Vulnerability Scanning 

- Banner Grabbing
    - BG is an information gathering technique 
    - The objective is to identify the service running on a specific port as well as the service version
    - Banner grabbing can be performed with
        - NMAP service detection
        - Connecting to the open port with netcat
        - Authenticating with the service (ssh, ftp, telnet)

- Vulnerability scanning with nmap scripts
    - /usr/share/nmap/scritps
    - Nmap scripts are written in LUA
    - /usr/share/nmap/scritps | grep vuln 

- Vulnerability scanning with Metasploit
    - Searchsploit
    - Search auxiliary modules, scanners, etc

Searching For Exploits

- Searching For Publicly Available Exploits
    - Exploit code can be easily found online, however, it can be dangerous to run 
    - Legitimate databases:
        - Exploit-db
        - Rapid7
        - Packet Storm 

- Searching for exploits with Searchsploit
    - Local database for exploit lookup
    - /usr/share/exploit-db

Fixing Exploits

- Fixing Exploits
    - Fix local IPs and ports
    - Some scipts may have extra requirements

- Cross-compiling Exploits
    - Some scripts may need to be compiled yo a portable executable or binary
    - Cross compiling is the process of compiling code for another platform other than the one performing the compilation
    - Need understanding on how to compile C programs 
    - Mingw-w64 to compile C programs for windows
        - 64 bits:
            - i686-w64-mingw32-gcc ex.c -o exploit
        - 32 bits:
            - i686-w64-mingw32-gcc ex.c -o exploit -lws2_32 
    - gcc to compile C programs for linux
    - exploit-db-bin-sploits for precompiled exploits

Bind & Reverse Shells

- Netcat fundamentals
    - TCP/IP Swiss army knife, used to read and write data using TCP or UDP
    - Available for windows and linux
    - Netcat utilizes client-server communication
    - Netcat can be used to:
        - Banner Grabbing
        - Port scanning
        - File transfer
        - Bind / reverse shells
    - Listen nc -nvlp <port>
    - Connect nc <ip> <port>
    - /usr/share/windows-binaries has nc.exe

- Bind shells
    - Type of remote shell where an attacker connects directly to a listener on the target system
    - A netcat listener can be setup to execute an executable like cmd.exe or /bin/bash
    - nc -nvlp 1234 -e cmd.exe
    - nc -nvlp 1234 -c /bin/bash

- Reverse shells
    - The target connects to the listener on an attacker's system

- Reverse shell cheatsheet
    - PayloadsAllTheThings (https://github.com/swisskyrepo/PayloadsAllTheThings)
    - Reverse Shell Generator (https://www.revshells.com/)

- PowerShell-Empire
    - Empire is a pure PowerShell exploitation/post-exploitation framework built on cryptological-secure communications 
    - Has the ability to run powershell without powershell.exe 
    - Keyloggers, mimikatz, network detection evasion
    - Starkiller is a GUI frontend for Empire

Windows Exploitation

- Windows Black Box Penetration Test 
    - The penetration test is not provided with any ionformation regarding the system or network
    - The objective is to accurately test the security of a system as an external unprivileged adversary
    - Methodlogy:
        - Host discovery
        - Port scanning and enumeration
        - Vulnerability detection 
        - Exploitation
            - Manual
            - Automated
        - Post Exploitation
            - Privilege escalation
            - Persistence
            - Dumping hashes

- Port Scanning & Enumeration
    - nmap -T4 -PA -sC -sV -p 1-10000 -oX name

- Targeting Microsoft IIS FTP
    - nmap -sV -p 21 --script=ftp-anon <host>
    - hydra -L /usr/share/wordlists/metasploit-framework/unix_users.txt -P /usr/share/wordlists/metasploit-framework/unix_passwords.txt <host> ftp

- Targeting OpenSSH
    - hydra

- Targeting SMB
    - smb-enum
    - hydra
    - enum4linux
    - psexec

- Targeting MySQL Server
    - hydra
    - Change or see configs in C:\\wamp\\www
    - net start wampache (to restart the service after changes)